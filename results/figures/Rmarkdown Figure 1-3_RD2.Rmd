---
title: "Age of Return"
subtitle: "Markdown for Figures 1 - 3"
author: "Caitlin O'Brien"
date: "1/4/2023"
output:
  rmarkdown::html_document:
    theme: sandstone
    toc: TRUE
    toc_float: FALSE
    code_folding: hide
---

# {.tabset}
Basefile wrangling
```{r, message=FALSE, error=FALSE, results='hide', class.source='fold-show'}
#packages
library(here)
library(tidyverse)
library(likert)
library(lubridate)
library(plotly)
library(ggpubr)
library(ggridges)
library(forcats)
library(gghighlight)

#import data
d<-read_csv(here("data", "data_adults.csv"))
d%>% mutate_if(sapply(d,is.character), as.factor)


#filter data 
##reassign any values not categorized at T/ROR.
###remove fork length > 155mm for all types--removes two values (162 & 164mm, t_run = 2) plus 6 NA's
#### only include 1998 to 2018 juv_lgr_first data.
#####extract smolt migration year ()

df<- d %>% 
 mutate(pass_type_T_R = dplyr::recode(pass_type_T_R, "TB" = "ROR", "RORBD" = "ROR")) %>% 
  filter(length < 155,
         juv_lgr_first > '1998-01-01 00:00:00' & juv_lgr_first < '2018-12-31 24:00:00') %>% 
            mutate(smy_year = lubridate::year(juv_lgr_first)) 
```


## Figure 1. Return Numbers
Number of smolts and adults by age vs smolt migration year. 



[likert plot](https://r-graph-gallery.com/202-barplot-for-likert-type-items.html) ~  where mini-jacks and jacks are on the left, and 2-ocean, 3-ocean, etc. are on the right.

- summarize data to include age grouping based on age column: 
  - mini-jack (0-ocean) 
  - jack (1-ocean)
  - 2-ocean
  - 3-ocean
  - 4-ocean or more.
  
figure 1 data wrangling:   
```{r, message=FALSE, error=FALSE,warning=FALSE, class.source='fold-show'}


                             
#calculate ocean age--
## extract first adu timestamp relabel-->adu_first column
### Calculate difference in years (adu_first-juv_lgr_first = diffyears)
####assign returnage value based on years_diff (see graph of years_diff to see breakdown of returnage)
d.ocean<-df %>% 
  mutate(adu_first = if_else(!is.na(adu_bon_first) , adu_bon_first , if_else(!is.na(adu_mcn_first),adu_mcn_first,if_else(!is.na(adu_ich_first),adu_ich_first,adu_lgr_first)))) %>% 
  mutate(years_diff = time_length(difftime(adu_first, juv_lgr_first), "years")) %>%  
  mutate(ReturnAge = case_when(years_diff <.5 ~ '0-Ocean', 
                              years_diff >=.5 & years_diff < 1.5 ~'1-Ocean',
                              years_diff >=1.5 & years_diff < 2.5 ~'2-Ocean',
                              years_diff >=2.5 & years_diff < 3.5 ~'3-Ocean', 
                              years_diff >= 3.5 & years_diff <5 ~'4-Ocean'))

#summarize data by return age
d.return<- d.ocean %>% 
  mutate_if(sapply(d.ocean,is.character), as.factor) %>% 
  group_by(pass_type_T_R, smy_year, ReturnAge) %>% 
  summarise( n = n())
```


```{r, message=FALSE, error=FALSE,warning=FALSE}
 #show breakdown of age by years_diff
    p<-ggplot(d.ocean, aes(x=smy_year, y= years_diff, color=ReturnAge))+
      geom_point()

ggplotly(p)

#Color Palette for Graphs
pal1<-hcl.colors(5,"Roma")

#prior
#scale_fill_manual(breaks = c("4-Ocean", "3-Ocean", "2-Ocean", "1-Ocean", "0-Ocean"),
                       #values =c("gray","azure2","lightskyblue3", "lightskyblue4","steelblue4"))+
```


### Figure 1a

```{r}
#stacked bar of counts
ggplot(d.return, aes(x=as.factor(smy_year), y= n, fill=forcats::fct_rev(ReturnAge)))+
  geom_bar(position = "stack", stat="identity", width = .7)+
  labs(x="Smolt Migration Year", y= "Number of returns ", 
       color="",
       fill ="",
       title = "Number of returns by age and migration year",
       subtitle = "Smolt Migration Year: 1998 to 2019",
       caption = "")+
  scale_fill_manual(values = pal1)+
  theme_classic()+
  theme(axis.text.x = element_text(angle = 90))
```


```{r}
#proportional stacked bar
ggplot(d.return, aes(x=as.factor(smy_year), y= n, fill=forcats::fct_rev(ReturnAge)))+
  geom_bar(position = position_fill(), stat="identity")+ 
  labs(x="Smolt Migration Year", y= "Proportion of returns ", 
       color="",
       fill ="",
       title = "Proportion of returns by age and migration year",
       subtitle = "Smolt Migration Year: 1998 to 2019",
       caption = "")+
    scale_fill_manual(values = pal1)+
  scale_y_continuous(labels = scales::percent)+
  theme_classic()+ 
  theme(axis.text.x = element_text(angle = 90))
```


### Figure 1b. 
Same as Figure 1a, with transported vs in-river juvenile fish categories distinguished.

```{r}
#labels for facet grid
p.labs <- c("In-River", "Transported")
names(p.labs) <- c("ROR", "T")

#stacked bar with pass_type
ggplot(d.return, aes(x=as.factor(smy_year), y= n, fill=forcats::fct_rev(ReturnAge)))+
  geom_bar(position = "stack", stat="identity", width = .7)+
  labs(x="Smolt Migration Year", y= "Number of returns ", 
       color="",
       fill ="",
       title = "Number of returns by age and migration year",
       subtitle = "Smolt Migration Year: 1998 to 2019",
       caption = "")+
    scale_fill_manual(values = pal1)+
  theme_classic()+
  theme(axis.text.x = element_text(angle = 90)) + facet_grid(~pass_type_T_R, labeller = labeller(pass_type_T_R = p.labs))
```


```{r}
#proportional stacked bar with transport and ROR

ggplot(d.return, aes(x=as.factor(smy_year), y= n, fill=forcats::fct_rev(ReturnAge)))+
  geom_bar(position = position_fill(), stat="identity")+ 
  labs(x="Smolt Migration Year", y= "Proportion of returns ", 
       color="",
       fill ="",
       title = "Proportion of in-river versus transported salmon returns by age and migration year",
       subtitle = "Smolt Migration Year: 1998 to 2019",
       caption = "")+
     scale_fill_manual(values = pal1)+
  scale_y_continuous(labels = scales::percent)+
  theme_classic()+ 
  theme(axis.text.x = element_text(angle = 90)) + facet_grid(~pass_type_T_R, labeller = labeller(pass_type_T_R = p.labs))

```

### Alternatives


Points with trend line wrapped by pass_type --numbers and proportions
```{r}
#labels for facet grid
p.labs <- c("In-River", "Transported")
names(p.labs) <- c("ROR", "T")

p1<-ggplot(d.return, aes(x = smy_year, y= n, group = ReturnAge, color=ReturnAge))+
  geom_point(aes(color=ReturnAge, fill= ReturnAge), alpha=.7,  shape=21, size =.75)+
  geom_line(linewidth = .65)+
  scale_color_manual(values = rev(pal1))+
  scale_fill_manual(values = rev(pal1))+
  labs(x="", y= "Number of adult returns ", 
       color="",
       fill ="",
       title = "",
       caption = "")+
theme_minimal()+ theme( legend.position = "none")+
  facet_wrap(~pass_type_T_R, labeller = labeller(pass_type_T_R = p.labs))
  
p1

p2<-ggplot(d.return, aes(x=as.factor(smy_year), y= n, fill=forcats::fct_rev(ReturnAge)))+
  geom_bar(position = position_fill(), stat="identity", width=.7)+ 
  labs(x="Smolt migration year", y= "Proportion of adult returns ", 
       color="",
       fill ="",
       title = "",
       caption = "")+
    scale_fill_manual(values = pal1)+
  scale_y_continuous(labels = scales::percent)+
  scale_x_discrete(breaks = function(x){x[c(TRUE, FALSE)]})+
  theme_classic() + facet_wrap(~pass_type_T_R)+
  theme(strip.text.x = element_blank(), legend.position = "bottom")



p.return<-ggarrange(p1,p2, nrow = 2, vjust=5)

p.return
```

alternative fig 1b- point plot with smoothing line for all return ages across years
```{r}
ggplot(d.return, aes(x = smy_year, y= n))+
  geom_point(aes(color=ReturnAge, fill= ReturnAge), alpha=.7,  shape=21)+
  geom_smooth(span=.3, color="black", alpha=.1, linewidth = .65)+
  scale_color_manual(values = rev(pal1))+
  scale_fill_manual(values = rev(pal1))+
  labs(x="", y= "Number of adult returns", 
       color="",
       fill ="",
       title = "",
       caption = "")+
theme_minimal()+ facet_wrap(~pass_type_T_R, labeller = labeller(pass_type_T_R = p.labs))+
  theme(axis.text.x = element_blank(), legend.position = "none")
```


Centered at 0 with stacked bar --numbers
```{r, fig.width=10}
#still need to fix labels for 0 and 1 ocean year 1999. Reverse label order


#grouping for labels
total<- d.return %>% 
  group_by(smy_year, ReturnAge) %>% 
  summarise(sum_labels = sum(n))

group1labs<- total%>% 
  filter(ReturnAge %in% c("0-Ocean","1-Ocean")) %>% 
    group_by(smy_year,ReturnAge) %>% 
  summarise(sum_g1 = sum(sum_labels))

group2labs<- total%>% 
  filter(!ReturnAge %in% c("0-Ocean","1-Ocean"))

tot.group <- total %>% 
  group_by(smy_year) %>% 
  summarise(sumtot = sum(sum_labels))


#subset data and graph two times to mimic likert plot
fig1a<-ggplot(d.return, aes(x=as.factor(smy_year))) + 
      geom_bar(data = subset(d.return, ReturnAge %in% c("0-Ocean","1-Ocean")),
               aes(y = -n,fill=ReturnAge), position="stack", stat="identity", width = .8) +
      geom_bar(data = subset(d.return, !ReturnAge %in% c("0-Ocean","1-Ocean")), 
               aes(y = n, fill = forcats::fct_rev(ReturnAge)), position="stack", stat="identity", width = .8)+
    labs(x="Smolt migration year", y= "Number of adult returns", 
       color="",
       fill ="",
       title = "Number of adult returns by age and smolt migration year",
       subtitle = "Smolt Migration Year: 1998 to 2019",
       caption = "")+
  scale_fill_manual(values = pal1, 
                    breaks = c("4-Ocean", "3-Ocean", "2-Ocean", "1-Ocean", "0-Ocean"))+
   theme_classic()+
  geom_text(data = subset(total, !ReturnAge %in% c("0-Ocean","1-Ocean")), aes( y=sum_labels, label = sum_labels), position = position_stack(vjust = .5))+
   geom_text(data = subset(total, ReturnAge %in% c("0-Ocean","1-Ocean")), aes( y=-sum_labels, label = sum_labels), position = position_stack(vjust = .1))+
  geom_text(data = tot.group, aes( y=175, label = sumtot, fill = NULL), fontface = "bold")
```

Centered at 0 with stacked bar -- proportions
```{r, fig.width=10}
#subset data and graph two times to mimic likert plot
ggplot(d.return, aes(x=as.factor(smy_year))) + 
  geom_bar(data = subset(d.return, ReturnAge %in% c("0-Ocean","1-Ocean")),
               aes(y = -n,fill=ReturnAge), position=position_fill(), stat="identity", width = .6) +
      geom_bar(data = subset(d.return, !ReturnAge %in% c("0-Ocean","1-Ocean")), 
               aes(y = n, fill = forcats::fct_rev(ReturnAge)), position=position_fill(),stat="identity", width = .6)+
    labs(x="Smolt Migration Year", y= "Number of Returns", 
       color="",
       fill ="",
       title = "Number of returns by age and migration year",
       subtitle = "Smolt Migration Year: 1998 to 2019",
       caption = "")+
 scale_fill_manual(values = pal1, 
                    breaks = c("4-Ocean", "3-Ocean", "2-Ocean", "1-Ocean", "0-Ocean"))+
   theme_classic()
 # geom_text(data = subset(total, !ReturnAge %in% c("0-Ocean","1-Ocean")), aes( y=sum_labels, label = sum_labels), position = position_stack(vjust = .5))+
  # geom_text(data = subset(total, ReturnAge %in% c("0-Ocean","1-Ocean")), aes( y=-sum_labels, label = sum_labels), position = position_stack(vjust = .1))+
 # geom_text(data = tot.group, aes( y=175, label = sumtot, fill = NULL), fontface = "bold")
```

Centered at 0 with stacked wrapped T/ROR -- numbers
```{r}
ggplot(d.return, aes(x=as.factor(smy_year))) + 
      geom_bar(data = subset(d.return, ReturnAge %in% c("0-Ocean","1-Ocean")),
               aes(y = -n,fill=ReturnAge), position="stack", stat="identity", width = .8) +
      geom_bar(data = subset(d.return, !ReturnAge %in% c("0-Ocean","1-Ocean")), 
               aes(y = n, fill = forcats::fct_rev(ReturnAge)), position="stack", stat="identity", width = .8)+
    labs(x="Smolt Migration Year", y= "Number of Returns", 
       color="",
       fill ="",
       title = "Number of returns by age and migration year",
       subtitle = "Smolt Migration Year: 1998 to 2019",
       caption = "")+
  scale_fill_manual(values = pal1, 
                    breaks = c("4-Ocean", "3-Ocean", "2-Ocean", "1-Ocean", "0-Ocean"))+
   theme_classic() + facet_wrap(~pass_type_T_R, ncol = 1)
```






## Figure 2. Fork Length



### Figure 2a. 
Fork length vs smolt migration year
[boxplot or violin plot, including outliers](https://r-graph-gallery.com/violin.html)

```{r}
fig.2a<-ggplot(df, aes(x=as.factor(smy_year), y=length)) +
  geom_violin(draw_quantiles = c(0.25, 0.5, 0.75), 
              color = "black", 
              trim = FALSE,
              size =.3)+
   geom_hline(yintercept=median(df$length), 
              linetype="solid", 
              color = "grey50", 
              size = .25)+
  geom_hline(yintercept = max(df$length),
             linetype = "dashed",
             color="grey50",
             size=.25)+
    geom_hline(yintercept = min(df$length),
             linetype = "dashed",
             color="grey50",
             size=.25)+
  #geom_point(alpha=.25, color = "grey40", size = 1) +
  labs(x="Smolt Migration Year", 
       y= "Fork Length (mm)", 
       color=" ",
      title = "Juvenile fish fork length vs smolt migration year",
      subtitle = "Smolt migration year: 1998 to 2018",
      caption = "")+
  theme_classic()+ 
  theme (legend.position = "none")

fig.2a
```

### Figure 2b. 
Transported vs in-river juvenile fish Fork length vs smolt migration year
  Same as Figure 2a, with  categories distinguished. Highlight median and range

Side-by-side of Transport and ROR violin graphs

```{r, echo=FALSE, warning=FALSE}
ggplot(df, aes(x=as.factor(smy_year), y=length, color=pass_type_T_R, fill=pass_type_T_R)) +
  geom_violin(draw_quantiles = c(0.25, 0.5, 0.75), 
              alpha=.2, 
              trim = FALSE, 
              size=.3)+
   geom_hline(yintercept=median(df$length), 
              linetype="solid", 
              color = "grey50", 
              size = .25)+
  geom_hline(yintercept = max(df$length),
             linetype = "dashed",
             color="grey50",
             size=.25)+
    geom_hline(yintercept = min(df$length),
             linetype = "dashed",
             color="grey50",
             size=.25)+
  #geom_point(alpha=.5, size = 1, aes(color=pass_type_T_R)) +
  labs(x="Smolt Migration Year", y= "Fork Length (mm)", 
       color="",
       fill ="",
       title = "Transported vs In-river Juvenile Fish Fork Length (mm)",
       subtitle = "Smolt Migration Year: 1998 to 2019",
       caption = "")+
  scale_color_manual(breaks = c("ROR", "T"),
                     labels = c("In-River", "Transported"),
                     values = c("cadetblue4","lemonchiffon3"))+
   scale_fill_manual(breaks = c("ROR", "T"),
                     labels = c("In-River", "Transported"),
                     values = c("cadetblue4","lemonchiffon3"))+
  theme_classic()+ 
  theme (legend.position = "top")
```


### Alternatives

Alternative 2a: Ridges 
```{r}
ggplot(df, aes(y = forcats::fct_rev(as.factor(smy_year)))) +
  geom_density_ridges(
    aes(x = length), 
    alpha = .8, color = "white", fill ="darkgrey",
    jittered_points = TRUE,
    position = position_points_jitter(width = 0.05, height = 0),
    point_shape = '|', point_size = 1, point_alpha = 1, alpha = 0.7
    , scale = 1) +
     geom_vline(xintercept=median(df$length), linetype="solid", color = "white", size = .5)+
  labs(
    x = "Fork Length (mm)",
    y = "Smolt Migration Year",
    fill ="",
    title = "Juvenile fish fork length (mm) vs smolt migration year",
    subtitle = "Smolt migration years: 1998 to 2018",
    caption = ""
  )+
  coord_cartesian(clip = "off") +
  theme_ridges(grid = FALSE)+theme(legend.position = "top")
```

Alternative 2b: Side-by-side of Transport and ROR violin graphs on side
```{r, fig.height=6, fig.width = 4}
ggplot(df, aes(y=forcats::fct_rev(as.factor(smy_year)), x=length, color=pass_type_T_R, fill=pass_type_T_R)) +
  geom_violin(draw_quantiles = c(0.25, 0.5, 0.75), 
              alpha=.2, 
              size = .3,
              trim = FALSE )+
   geom_vline(xintercept=median(df$length), 
              linetype="solid", 
              color = "grey70", 
              size = .3)+
  geom_vline(xintercept = max(df$length),
             linetype = "dashed",
             color="grey70",
             size=.3)+
    geom_vline(xintercept = min(df$length),
             linetype = "dashed",
             color="grey70",
             size=.3)+
  #geom_point(alpha=.5, size = 1, aes(color=pass_type_T_R)) +
  labs(y="Smolt migration year", x= "Fork Length (mm)", 
       color="",
       fill ="",
       title = "Transported vs in-river juvenile fish fork length (mm)",
       subtitle = "Smolt Migration Year: 1998 to 2018",
       caption = "")+
  scale_color_manual(breaks = c("ROR", "T"),
                     labels = c("In-River", "Transported"),
                     values = c("cadetblue4","lemonchiffon3"))+
   scale_fill_manual(breaks = c("ROR", "T"),
                     labels = c("In-River", "Transported"),
                     values = c("cadetblue4","lemonchiffon3"))+
  theme_classic()+ 
  theme (legend.position = "top")
```

Alternative 2b: Ridges with transport and ROR

```{r, echo=FALSE, warning=FALSE, message=FALSE, error=FALSE}



fig2.ridges<-  ggplot(df, aes(y = forcats::fct_rev(as.factor(smy_year)))) +
  geom_density_ridges(
    aes(x = length, fill = pass_type_T_R), 
    alpha = .8, color = "white",
    jittered_points = TRUE,
    position = position_points_jitter(width = 0.05, height = 0),
    point_shape = '|', point_size = 1, point_alpha = 1, alpha = 0.7
    , scale = 1) +
     geom_vline(xintercept=median(df$length), linetype="solid", color = "white", size = .5)+
  labs(
    x = "Fork Length (mm)",
    y = "Smolt Migration Year",
    fill ="",
    title = "Transported vs in-river juvenile fish fork length (mm)",
    subtitle = "Smolt migration years: 1998 to 2018",
    caption = ""
  )+
  scale_fill_manual(breaks = c("ROR", "T"),
                     labels = c("In-River", "Transported"),
                     values = c( "cadetblue4","lemonchiffon3"))+  
  coord_cartesian(clip = "off") +
  theme_ridges(grid = FALSE)+theme(legend.position = "top")
```





## Figure 3. Release Location


figure 3 data wrangling
```{r, warning=FALSE, error=FALSE, message=FALSE, class.source='fold-show'}
##group and summarize to get count of returns per year>subbasin>pass_type

d.rel <-df %>% mutate_if(sapply(df,is.character), as.factor) %>% 
  group_by(smy_year, subbasin, pass_type_T_R) %>% 
  summarise( count = n())

loc.sum <-df %>% mutate_if(sapply(df,is.character), as.factor) %>% 
  group_by(subbasin,pass_type_T_R) %>% 
  summarise( count = n()) %>% 
  arrange(desc(count))
 loc.sum  
 
 sum(loc.sum$count)
```

### Figure 3a. 
Proportion by release location vs. year 
[stream graph](https://r-graph-gallery.com/streamgraph.html) or [stacked area chart](https://r-graph-gallery.com/stacked-area-graph.html)


```{r}
library(RColorBrewer)
# Define the number of colors you want
nb.cols <- 19
mycolors <- colorRampPalette(brewer.pal(9, "Set2"))(nb.cols)

ggplot(d.rel, aes(y=reorder(subbasin, count), x= count, fill=reorder(subbasin, -count)))+
  geom_bar(position = "stack", stat="identity")+ 
  scale_fill_manual(values = mycolors) +
  theme_minimal()+
  facet_wrap(~smy_year, ncol=3)
  
  ggplot(d.rel, aes(x=forcats::fct_rev(as.factor(smy_year)), y= count, fill=reorder(subbasin, -count)))+
  geom_bar(position = "fill", stat="identity")+ 
    scale_fill_manual(values = mycolors)
```

facetwrap
```{r}

ggplot(d.rel, aes(y=count, x= as.factor(smy_year), fill=reorder(subbasin, -count)))+
  geom_bar(position = "stack", stat="identity")+ 
  scale_fill_manual(values = mycolors) +
  labs(x="Smolt Migration Year",
       y="Number of Adult Returns")+
   scale_x_discrete(breaks = function(x){x[c(TRUE, FALSE)]})+
  theme_minimal()+
  facet_wrap(~reorder(subbasin, -count))+theme(legend.position = "none")




```



### Figure 3b. 
Proportion by release location vs. year of transported vs in-river juvenile fish
Same as Figure 3a, with transported vs in-river juvenile fish categories distinguished.

Stacked bars numbers and proportions for T/ROR (doesn't include year)
```{r}
# bar numbers
fig3b1<-ggplot(loc.sum, aes(x=reorder(subbasin,count), y= count, fill=pass_type_T_R))+
  geom_bar(position = "stack", stat="identity")+ 
  labs(x="",
       y="Number of Adult Returns",
       fill="", 
       title = "Number and proportion of adult returns by subbasin and passage type",
       subtitle = "Smolt migration years: 1998-2018")+
  scale_fill_manual(breaks = c("T", "ROR" ),
                     labels = c( "Transported", "In-River"),
                     values = c( "lemonchiffon3", "cadetblue4"))+  
  geom_text(aes(y=count, label=count), position = position_stack(vjust = .5))+
  coord_flip() + theme_minimal()+ theme(legend.position = "bottom")

#bar proportion
fig3b2<-ggplot(loc.sum, aes(x=reorder(subbasin,count), y= count, fill=pass_type_T_R))+
  geom_bar(position = "fill", stat="identity")+ 
  scale_fill_manual(breaks = c("T", "ROR" ),
                     labels = c( "Transported", "In-River"),
                     values = c( "lemonchiffon3", "cadetblue4"))+  
  #geom_text(aes(y=count, label=count), position = position_stack(vjust = .5))+
  labs(x="",
       y="Proportion of Adult Returns",
       fill="", 
       title = "",
      subtitle = "" )+
   scale_y_continuous(labels = scales::percent)+
  coord_flip() + theme_minimal()+theme(legend.position = "bottom", axis.text.y = element_blank())

#proportion wrapped by year
pwrap<-ggplot(d.rel, aes(x=as.factor(smy_year), y= count, fill=pass_type_T_R))+
  geom_bar(position = "fill", stat="identity", width=.7)+ 
  labs(x="",
       y="Proportion of Adult Returns",
       fill="", 
       title = "Proportion of adult returns by subbasin and passage type vs smolt migration year",
       subtitle = "Smolt migration years: 1998-2018")+
  scale_fill_manual(breaks = c("T", "ROR" ),
                     labels = c( "Transported", "In-River"),
                     values = c( "lemonchiffon3", "cadetblue4"))+  
    scale_y_continuous(labels = scales::percent)+
  theme_minimal()+ theme(legend.position = "none", axis.text.x=element_text(angle=90, vjust = 0.5, hjust=1, size = 4))+ 
  facet_wrap(~reorder(subbasin, -count), ncol=6)
pwrap

p<-ggarrange(ggarrange(fig3b1, fig3b2, ncol = 2,  common.legend = T, legend = "top"),pwrap, # first row with two plots
          nrow = 2
          
          ) 
```

stacked numbers facetwrap by year
```{r}
##save 1800 by 1800 
#numbers
pwrap<-ggplot(d.rel, aes(x=reorder(subbasin,count), y= count, fill=pass_type_T_R))+
  geom_bar(position = "stack", stat="identity")+ 
  labs(x="",
       y="Number of Adult Returns",
       fill="", 
       title = "Number of adult returns by subbasin and passage type vs smolt migration year",
       subtitle = "Smolt migration years: 1998-2018")+
  scale_fill_manual(breaks = c("T", "ROR" ),
                     labels = c( "Transported", "In-River"),
                     values = c( "lemonchiffon3", "cadetblue4"))+  
  coord_flip() + 
  theme_minimal()+ theme(legend.position = "none")+
  facet_wrap(~smy_year, ncol=6)
pwrap


##proportion
ggplot(d.rel, aes(x=reorder(subbasin,count), y= count, fill=pass_type_T_R))+
  geom_bar(position = "fill", stat="identity")+ 
  labs(x="",
       y="Number of Returns",
       fill="", 
       title = "Number of adult returns by subbasin vs smolt migration year",
       subtitle = "Smolt migration years: 1998-2018")+
  scale_fill_manual(breaks = c("T", "ROR" ),
                     labels = c( "Transported", "In-River"),
                     values = c( "lemonchiffon3", "cadetblue4"))+  
  coord_flip() + theme_minimal()+ theme(legend.position = "none")+facet_wrap(~smy_year, ncol=3)
```

### Alternative

Centered at 0, likert like 
```{r}

ggplot(loc.sum, aes(y=reorder(subbasin,count)))+
geom_bar(data = subset(loc.sum, pass_type_T_R %in% c("ROR")),
               aes(x = count,fill=pass_type_T_R), stat="identity", width = .8) +
      geom_bar(data = subset(loc.sum, !pass_type_T_R %in% c("ROR")), 
               aes(x = -count, fill = pass_type_T_R), stat="identity", width = .8)
```



